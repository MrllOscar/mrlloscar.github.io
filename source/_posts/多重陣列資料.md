---
title: 多重陣列資料
date: 2021-11-30 15:03:13
index_img: https://picsum.photos/250/250/?random=11
categories: 
- [疑難雜症]
tags: [ PHP, 疑難雜症 , 多重, 多重陣列, 傳址]
---
# <font color=#FF6600>多重陣列資料</font>

昨天我們學長出了一個題目給我們做思考

```php
$original= [
'0'=>['day'=> "2021-11-29", 'time'=> ["09:30-13:00", "13:30-23:30"]],
'1'=>['day'=> "2021-11-30", 'time'=> ["09:30-13:00", "13:30-23:30"]],
'2'=>['day'=> "2021-12-01", 'time'=> ["09:30-13:00", "13:30-23:30"]],
'3'=>['day'=> "2021-12-02", 'time'=> ["09:30-13:00", "13:30-23:30"]]
];

$result = [
'0'=>['day'=> "2021-11-29", 'time'=> ["09:30-13:00", "13:30-23:30"],'select'=>['0930的時間'=>0930~1000,'0945的時間'=>0945~1015,'1000的時間'=>1000~1030,...,'1215的時間'=>1215~1245,'1230的時間'=>1230~1300,'1330的時間'=>1330~1400,......,'2300的時間'=>2300~2330]]
'1'=>['day'=> "2021-11-30", 'time'=> ["09:30-13:00", "13:30-23:30"],'select'=>['0930的時間'=>0930~1000,'0945的時間'=>0945~1015,'1000的時間'=>1000~1030,...,'1215的時間'=>1215~1245,'1230的時間'=>1230~1300,'1330的時間'=>1330~1400,......,'2300的時間'=>2300~2330]]
'2'=>['day'=> "2021-12-01", 'time'=> ["09:30-13:00", "13:30-23:30"],'select'=>['0930的時間'=>0930~1000,'0945的時間'=>0945~1015,'1000的時間'=>1000~1030,...,'1215的時間'=>1215~1245,'1230的時間'=>1230~1300,'1330的時間'=>1330~1400,......,'2300的時間'=>2300~2330]]
'3'=>['day'=> "2021-12-02", 'time'=> ["09:30-13:00", "13:30-23:30"],'select'=>['0930的時間'=>0930~1000,'0945的時間'=>0945~1015,'1000的時間'=>1000~1030,...,'1215的時間'=>1215~1245,'1230的時間'=>1230~1300,'1330的時間'=>1330~1400,......,'2300的時間'=>2300~2330]]
];
```

用簡短的方式把`$origin`變成`$result`，光這題就花掉我半天時間

[我的作法](http://sandbox.onlinephpfunctions.com/code/f152f24622022cf2bfcf0e18245d66aa93741211)

之後下午接收到訊息是time裡面不一定是固定時間也不一定兩個時段，所以寫法又有更改

弄到下班還是差了臨門一腳，看來只能明天再繼續了。

[半成品](http://sandbox.onlinephpfunctions.com/code/c7bb48b962ddc04e2cddb77dd01ed0a991ceffb0)
<!-- [半成品2](https://sandbox.onlinephpfunctions.com/code/633e249d760953f802d58703e6d81c3d90467ba3) -->

```php
$reservation_time_list= [
'0'=>['day'=> "2021-11-29", 'time'=> ["09:30-13:00", "13:30-23:30"]],
'1'=>['day'=> "2021-11-30", 'time'=> ["03:30-09:00", "19:30-23:30"]],
'2'=>['day'=> "2021-12-01", 'time'=> ["08:30-12:00", "13:30-23:30"]],
'3'=>['day'=> "2021-12-02", 'time'=> ["09:30-13:00", "13:30-23:30"]]
];

    $select=[];
    foreach($reservation_time_list as $index => $each){
        //確認有效時間
        foreach($each['time'] as $key => $value)
        {
            //拆開時段的始 末時間
            $opentime=mb_split('-',$value);
            //時段會在同一陣列內，拆成秒數
            foreach($opentime as $tmpkey => $time)
            {
                $start[$tmpkey]=strtotime($time)- strtotime('TODAY');
            }
    //處理時間
    //一天86400秒，15分鐘900秒
                $count=count($start);
                print_r($start);
            for($i=0;$i<86400;$i+=900)
            {
                //時間始至末的秒數
                if($i>=$start[0] && ($i+1800)<=$start[1])
                {
                    $select+=[gmdate('Hi的時間戳',$i)=>gmdate('Hi',$i).'~'.gmdate('Hi',($i+1800))];
                }
            }
        }
    //資料倒回原始陣列

        $reservation_time_list[$index]['select']=$select;
    }
    print_r($reservation_time_list);
```

<font color=#DD2222>大神提供給我的版本</font>

[大神版本](http://sandbox.onlinephpfunctions.com/code/2da6f447069c5f529be1ed862fd49f8671cd933a)

```php
define('TIMESTAMP_INTERVAL', 15 * 60); // 時間戳間隔
define('TIMESTAMP_LENGTH', 30 * 60); // 時間戳長度

$lists = [
    '0' => ['day' => "2021-11-29", 'time' => ["09:30-13:00", "13:30-23:30"]],
    '1' => ['day' => "2021-11-30", 'time' => ["09:30-13:00", "13:30-23:30"]],
    '2' => ['day' => "2021-12-01", 'time' => ["09:30-13:00", "13:30-23:30"]],
    '3' => ['day' => "2021-12-02", 'time' => ["09:30-13:00", "13:30-23:30"]]
];


foreach ($lists as &$list) {
    $result = [];
    foreach ($list['time'] as $time) {
        $startTime = strtotime(explode('-', $time)[0]);
        $endTime = strtotime(explode('-', $time)[1]);
        $result = array_merge($result, generatTimestamps($startTime, $endTime));
    }
    $list['select'] = $result;
}


function generatTimestamps(int $startTime, int $endTime): array
{
    $quotient = intval(($endTime - $startTime) / TIMESTAMP_INTERVAL);
    $stamps = [];
    for ($i = 0; $i <= $quotient; $i++) {
        $stampStartTime = date('H:i', $startTime + TIMESTAMP_INTERVAL * $i);
        $stampEndTime = date('H:i', $startTime + TIMESTAMP_INTERVAL * $i + TIMESTAMP_LENGTH);
        $stamps[$stampStartTime] = sprintf("%s ~ %s", $stampStartTime, $stampEndTime);
    }
    return $stamps;
}


print_r($lists);
```

整體來說

學長的code寫法整個算起來才是比較完整且乾淨的，給人感覺就是該用什麼函式就用什麼

看來我還太淺了 (๑•́ ₃ •̀๑)

### <font color=#FFD700>傳址</font>

其中也有一個"&"傳址的東西值得研究，這在我當初考試的時候並沒有使用

但學長的code有使用到，而且會比重新做一個新陣列去接他來的容易

```php
//使用未參考
echo "直接傳值:";
$value1 = "halo world";
$value2 = $value1;
$value3 = $value2;
$value1 = "show me ";
echo "$value1 $value2 $value3 ||| " ;

//使用參考
echo "使用傳址參考:";
$value1 = "halo world";
$value2 =& $value1;
$value3 =& $value2;

$value1 = "show me ";
echo "$value1 $value2 $value3" ;
```

輸出結果會是：

`直接傳值:show me  halo world halo world ||| 使用傳址參考:show me  show me  show me `

懂他的差異了嗎？

傳值是只有改變原始的東C，所以1被改變後，因程式碼關係不影響23

傳址會繼承上去，1被改變之後，23也會變成被改變的形狀

看來今天又比昨天更進步了一點呢(˘•ω•˘)