---
title: 資料整理
date: 2021-12-16 11:08:40
index_img: /img/2021-12-16133231.png
categories: 
- [疑難雜症]
tags: [ PHP, 疑難雜症 , 多重, 多重陣列, 傳址]
---

# <font color=#FF6600>JSON資料整理</font>

這次工作到一段落，有時間喘口氣

學長出了一個新的題目給我們

題目：資料是一筆商品配送訂單，會有相對應的配送平台

如果今天平台沒開或是故障、錯誤等等，會回傳一個訊息

當收到訊息時觸發這個函式，將這個平台的配送時間變為0，下一家的時間直接遞補上來

其中，第一家平台會算到下一分鐘的整點時間，所以要做相對應的調整
(12點0分12秒→12點1分0秒開始計算)

格式中，type不影響，store為配送平台，start_time為開始時間，end_time為結束時間，expire_minute為等待分鐘

<font color=#800080>來源資料是json格式</font>
```php
$order_dispatcher='[{"type":1,"store":"5","start_time":1639554623,"end_time":1639554719,"expire_minute":"1"},
{"type":1,"store":"6","start_time":1639554720,"end_time":1639554899,"expire_minute":"3"},
{"type":1,"store":"2","start_time":1639554900,"end_time":1639555079,"expire_minute":"3"},
{"type":1,"store":"1","start_time":1639555080,"end_time":1639555679,"expire_minute":"10"},
{"type":1,"store":"3","start_time":1639555680,"end_time":1639555979,"expire_minute":"5","is_after":1}]';
```
<font color=#800080>輸出</font>
```php
$result='[{"type":1,"store":"5","start_time":1639554623,"end_time":1639554719,"expire_minute":"1"},
{"type":1,"store":"6","start_time":1639554720,"end_time":1639554899,"expire_minute":"3"},
{"type":1,"store":"2","start_time":0,"end_time":0,"expire_minute":"3"},
{"type":1,"store":"1","start_time":1639554900,"end_time":1639555259,"expire_minute":"10"},
{"type":1,"store":"3","start_time":1639555260,"end_time":1639555559,"expire_minute":"5","is_after":1}]';
```

其中沒有發現is_after標籤來判斷最後一個

所以用count去算，針對第一個或最後一個還要做特定的判斷

[我的解答](http://sandbox.onlinephpfunctions.com/code/9bbac3fd1d51ee99cc4d56ebf2f191241db4d8bc)請各位小力鞭....如果有更好的做法也歡迎提供給我互相進步  (๑•́ ₃ •̀๑)

```php
function logAlert($el){
$order_dispatcher='[{"type":1,"store":"5","start_time":1639554623,"end_time":1639554719,"expire_minute":"1"},
{"type":1,"store":"6","start_time":1639554720,"end_time":1639554899,"expire_minute":"3"},
{"type":1,"store":"2","start_time":1639554900,"end_time":1639555079,"expire_minute":"3"},
{"type":1,"store":"1","start_time":1639555080,"end_time":1639555679,"expire_minute":"10"},
{"type":1,"store":"3","start_time":1639555680,"end_time":1639555979,"expire_minute":"5","is_after":1}]';

$order_dispatcher=json_decode($order_dispatcher,TRUE);
foreach($order_dispatcher as $key => $result)
{
    $startTime=$order_dispatcher[0]['start_time'];
    if($startTime%60 != 0)   //   處理第一筆時間歸為整數計算
    {
        $startIntergerTime = $startTime+(60-($startTime%60));
    }
    if($order_dispatcher[$key]['store']==$el)
    {
        $keyChange=$key+1;
        $startChange=$order_dispatcher[$key]['start_time'];
        $order_dispatcher[$key]['start_time']=0;
        $order_dispatcher[$key]['end_time']=0;
    }

    if(isset($keyChange))    // 被改變後才開始處理
    {
        if($key==$keyChange){
            $order_dispatcher[$key]['start_time']=$startChange;
            $order_dispatcher[$key]['end_time']=$startIntergerTime+($order_dispatcher[$key]['expire_minute']*60)-1;
        }
        
        if($key>$keyChange){
            $order_dispatcher[$key]['start_time']=$order_dispatcher[$key-1]['end_time']+1;
            $order_dispatcher[$key]['end_time']=$order_dispatcher[$key]['start_time']-1+($order_dispatcher[$key]['expire_minute']*60);
        }
    }
}
print_r(json_encode($order_dispatcher));
}
logAlert($input);
```